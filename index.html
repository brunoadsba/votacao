<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Vota√ß√£o - 1¬∫ Hackathon+ SESI Sa√∫de</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .star-rating { display: inline-flex; gap: 2px; }
        .star { color: #d1d5db; cursor: pointer; transition: color 0.2s; }
        .star.active { color: #fbbf24; }
        .star:hover { color: #f59e0b; }
        @media print { .no-print { display: none !important; } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sesi-orange { color: #FF6B35; }
        .sesi-blue { color: #1E40AF; }
        .idea-card { transition: all 0.3s ease; border-left: 4px solid #e5e7eb; }
        .idea-card:hover { border-left-color: #3b82f6; transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mb-4"></div>
            <p class="text-gray-600">Carregando sistema...</p>
        </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="access-denied" class="hidden min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center">
            <i class="fas fa-lock text-6xl text-red-500 mb-4"></i>
            <h1 class="text-2xl font-bold text-red-600 mb-4">Acesso Inv√°lido</h1>
            <p class="text-gray-600 mb-4">C√≥digo de participante n√£o reconhecido ou acesso n√£o autorizado.</p>
            <p class="text-sm text-gray-500">Entre em contato com o organizador para obter um link v√°lido.</p>
        </div>
    </div>

    <!-- Admin Login Screen -->
    <div id="admin-login" class="hidden min-h-screen flex items-center justify-center gradient-bg">
        <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full">
            <div class="text-center mb-6">
                <i class="fas fa-shield-alt text-4xl text-blue-600 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800">Painel Administrativo</h2>
                <p class="text-gray-600">1¬∫ Hackathon+ SESI Sa√∫de</p>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Senha de Acesso:</label>
                <input type="password" id="admin-password" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Digite a senha">
            </div>
            <button onclick="checkAdminPassword()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fas fa-sign-in-alt mr-2"></i>Entrar
            </button>
            <div id="login-error" class="hidden mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm">
                Senha incorreta. Tente novamente.
            </div>
        </div>
    </div>

    <!-- Participant Voting Interface -->
    <div id="participant-interface" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b-4 border-blue-600">
            <div class="max-w-6xl mx-auto px-4 py-6">
                <div class="text-center">
                    <div class="flex justify-center items-center mb-4">
                        <i class="fas fa-brain text-5xl text-blue-600 mr-4"></i>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">1¬∫ Hackathon+ SESI Sa√∫de</h1>
                            <p class="text-lg text-gray-600">Workshop - Defini√ß√£o dos Desafios</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Avalia√ß√£o e Desenvolvimento de Ideias com IA</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data:</label>
                                <input type="date" id="meeting-date" class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Participante:</label>
                                <input type="text" id="participant-name" class="w-full p-2 border rounded bg-gray-100" readonly>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Voting Interface -->
        <div class="max-w-6xl mx-auto px-4 py-8">
            <div id="voting-active">
                <!-- Ideias Vi√°veis -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-lightbulb text-yellow-500 mr-3"></i>
                        Ideias Vi√°veis
                    </h2>
                    <div class="grid gap-6" id="viable-ideas"></div>
                </section>

                <!-- Ideias Disruptivas -->
                <section class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-rocket text-purple-500 mr-3"></i>
                        Ideias Disruptivas
                    </h2>
                    <div class="grid gap-6" id="disruptive-ideas"></div>
                </section>

                <!-- Brainstorm Area -->
                <section class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-comments text-green-500 mr-3"></i>
                        Espa√ßo para Brainstorm
                    </h2>
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <textarea id="brainstorm-notes" rows="6" class="w-full p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 resize-none" placeholder="Digite suas anota√ß√µes, insights e observa√ß√µes da reuni√£o aqui..."></textarea>
                    </div>
                </section>

                <!-- Submit Button -->
                <div class="text-center">
                    <button onclick="submitVoting()" class="bg-green-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>üì§ Finalizar e Enviar
                    </button>
                </div>
            </div>

            <!-- Submission Confirmation -->
            <div id="submission-success" class="hidden text-center py-12">
                <div class="bg-green-50 p-8 rounded-lg max-w-2xl mx-auto">
                    <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                    <h2 class="text-2xl font-bold text-green-700 mb-4">Vota√ß√£o Enviada com Sucesso!</h2>
                    <p class="text-green-600 mb-4">Suas avalia√ß√µes foram registradas e enviadas para a consolida√ß√£o.</p>
                    <p class="text-gray-600 text-sm">Obrigado pela sua participa√ß√£o no 1¬∫ Hackathon+ SESI Sa√∫de</p>
                    <div id="backup-data" class="mt-4 p-3 bg-blue-50 rounded text-xs text-left overflow-auto max-h-32"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6 mt-12">
            <div class="max-w-6xl mx-auto px-4 text-center">
                <p class="text-lg font-semibold">1¬∫ Hackathon+ SESI Sa√∫de</p>
                <p class="text-gray-400">Desenvolvido por Bruno Almeida</p>
            </div>
        </footer>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="hidden">
        <header class="bg-gray-800 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold">Painel Administrativo</h1>
                        <p class="text-gray-300">1¬∫ Hackathon+ SESI Sa√∫de</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="exportAllData()" class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-700 transition-colors">
                            <i class="fas fa-download mr-2"></i>Baixar TODOS os Dados
                        </button>
                        <button onclick="exportToPDF()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                            <i class="fas fa-file-pdf mr-2"></i>Salvar PDF
                        </button>
                        <button onclick="copyResults()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700 transition-colors">
                            <i class="fas fa-copy mr-2"></i>Copiar Resultados
                        </button>
                        <button onclick="refreshData()" class="bg-yellow-600 px-4 py-2 rounded hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>Atualizar
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-8">
            <!-- Participants Status -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-xl font-bold mb-4">Status dos Participantes</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="participants-status"></div>
            </div>

            <!-- Results Summary -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-xl font-bold mb-4">Resumo dos Resultados</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-yellow-600">üèÜ Top 3 - Ideias Vi√°veis</h3>
                        <div id="top-viable" class="space-y-2"></div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-purple-600">üöÄ Top 3 - Ideias Disruptivas</h3>
                        <div id="top-disruptive" class="space-y-2"></div>
                    </div>
                </div>
                <div class="mt-8 text-center">
                    <div id="overall-champion" class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4"></div>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-bold mb-4">Resultados Detalhados</h2>
                <div id="detailed-results"></div>
            </div>
        </div>
    </div>

    <script>
        // Data Structure
        const participants = {
            'H7K9M2': 'Andr√© Luiz Carvalho',
            'F3L8N1': 'Bruna Ferreira Machado',
            'R5T2P9': 'Caio Roberto Nogueira',
            'K8W4D6': 'Daniela Marques Teixeira',
            'M1B7X5': 'Eduardo Pereira da Silva',
            'Q9C3Z8': 'Fernanda Souza Correia',
            'T6Y2V4': 'Guilherme Almeida Castro',
            'J4S1G9': 'Helena Ara√∫jo Monteiro',
            'A8E5L3': 'Isabela Moura Santana',
            'P2N6U7': 'Jo√£o Pedro Barbosa',
            'W9I4O1': 'Karina Oliveira Ramos',
            'D5H8K2': 'Leandro Martins Farias',
            'B3F7R6': 'Mariana Costa Ribeiro',
            'X1Q4T8': 'Nicolas Henrique Duarte',
            'C7V2J5': 'Patr√≠cia Andrade Lopes',
            'N4L9S3': 'Renato Figueiredo Campos',
            'G6Z8A1': 'Sabrina Rocha Pacheco',
            'Y2M5E7': 'Tiago Moreira Bastos'
        };

        const viableIdeas = [
            { id: 'chatbot-suporte', title: 'Chatbot de Suporte √† Sa√∫de Mental', description: 'Prot√≥tipo com GPT (via API) para escuta inicial e direcionamento. Pode ser feito em Flask ou Node com frontend simples.' },
            { id: 'detector-epi', title: 'Detector de EPI com Vis√£o Computacional', description: 'Usar YOLOv5 ou MobileNet com dataset pequeno (capacete, luva, etc). Prot√≥tipo via webcam com feedback visual.' },
            { id: 'dashboard-preditivo', title: 'Dashboard Preditivo de Afastamentos', description: 'Simular dados de funcion√°rios e usar scikit-learn para prever risco de afastamento. Interface com Streamlit.' },
            { id: 'reconhecimento-voz', title: 'Reconhecimento de Voz para Relato de Incidentes', description: 'Usar API como Whisper ou SpeechRecognition para transformar voz em texto e salvar registros simulados.' },
            { id: 'analise-sentimentos', title: 'An√°lise de Sentimentos em Feedbacks de Sa√∫de Ocupacional', description: 'Treinar um modelo leve (NLTK ou transformers) para analisar textos de pesquisas internas de clima/sa√∫de.' },
            { id: 'assistente-virtual', title: 'Assistente Virtual com IA para D√∫vidas sobre Seguran√ßa do Trabalho', description: 'Chat simples com base de dados de NR (Normas Regulamentadoras) integradas num modelo b√°sico.' },
            { id: 'treinamento-gamificado', title: 'Plataforma de Treinamento Gamificado com IA', description: 'Quiz adaptativo com Python/Flask + IA para ajustar dificuldade conforme acertos/erros do usu√°rio.' }
        ];

        const disruptiveIdeas = [
            { id: 'digital-twin', title: 'Digital Twin de Seguran√ßa e Sa√∫de Ocupacional', description: 'Criar um "g√™meo digital" do ambiente de trabalho usando sensores e IA para simular riscos, prever acidentes e testar medidas preventivas em tempo real.' },
            { id: 'prevencao-burnout', title: 'IA para Preven√ß√£o de Burnout em Tempo Real', description: 'Algoritmo que cruza padr√µes de e-mails, mensagens internas (via API fake) e horas trabalhadas para detectar sinais de esgotamento mental ou burnout.' },
            { id: 'monitoramento-comportamental', title: 'Monitoramento Comportamental com IA e Gamifica√ß√£o', description: 'IA que analisa o comportamento dos trabalhadores (intera√ß√µes, uso de EPIs, pausas) e d√° feedbacks gamificados para incentivar h√°bitos saud√°veis.' },
            { id: 'anjo-virtual', title: 'Anjo Virtual de Primeiros Socorros com IA Multimodal', description: 'Assistente com IA (voz + texto + imagem) para guiar colaboradores em emerg√™ncias, usando linguagem natural e reconhecimento de objetos/situa√ß√µes.' },
            { id: 'ia-etica', title: 'IA √âtica para Acompanhamento de Inclus√£o e Diversidade', description: 'Ferramenta que analisa dados de sa√∫de e seguran√ßa com foco em equidade, identificando disparidades no cuidado com grupos espec√≠ficos (PDCs, mulheres, etc.).' },
            { id: 'auditoria-inteligente', title: 'Sistema Inteligente de Auditoria de SST via IA', description: 'Plataforma que audita automaticamente dados de SST (documentos, fotos, v√≠deos) com IA e gera alertas de n√£o conformidades com as NRs.' },
            { id: 'previsao-doencas', title: 'IA Previsora de Doen√ßas Ocupacionais por Perfil Funcional', description: 'Modelo de machine learning que, com base no cargo, atividades e hist√≥rico cl√≠nico, projeta a probabilidade de desenvolver doen√ßas como LER/DORT, surdez, etc.' }
        ];

        let currentUser = null;
        let userVotes = {};

        // Firebase Config (RTDB + Fallback)
        const firebaseConfig = {
            apiKey: "AIzaSyCbH6vvO75BNUik6d-2xFmszXvXbC9zLbo",
            authDomain: "hackathon-sesi.firebaseapp.com",
            databaseURL: "https://hackathon-sesi-default-rtdb.firebaseio.com/",
            projectId: "hackathon-sesi",
            storageBucket: "hackathon-sesi.firebasestorage.app",
            messagingSenderId: "124533455216",
            appId: "1:124533455216:web:21397ca5efbfb95235f7b5"
        };

        // BACKUP SOLUTION: Direct HTTP calls to RTDB
        async function saveToRTDB(code, data) {
            try {
                console.log('üî• BACKUP: Tentando gravar diretamente no RTDB via HTTP...');
                const response = await fetch(`${firebaseConfig.databaseURL}/submissions/${code}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ BACKUP: Dados gravados no RTDB:', result);
                    return { success: true, backend: 'rtdb-http' };
                } else {
                    console.error('‚ùå BACKUP: Erro HTTP no RTDB:', response.status);
                    return { success: false, error: response.status };
                }
            } catch (error) {
                console.error('‚ùå BACKUP: Erro de rede:', error);
                return { success: false, error: error.message };
            }
        }

        async function getAllFromRTDB() {
            try {
                const response = await fetch(`${firebaseConfig.databaseURL}/submissions.json`);
                if (response.ok) {
                    const data = await response.json();
                    return { success: true, data: data || {} };
                }
                return { success: false, data: {} };
            } catch (error) {
                console.error('‚ùå BACKUP: Erro ao ler RTDB:', error);
                return { success: false, data: {} };
            }
        }

        // Initialize Application
        function init() {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                
                const urlParams = new URLSearchParams(window.location.search);
                const codigo = urlParams.get('codigo');
                const admin = urlParams.get('admin');

                if (admin === 'true') {
                    showAdminLogin();
                } else if (codigo && participants[codigo]) {
                    currentUser = codigo;
                    showParticipantInterface();
                } else {
                    showAccessDenied();
                }
            }, 1000);
        }

        function showAccessDenied() {
            document.getElementById('access-denied').classList.remove('hidden');
        }

        function showAdminLogin() {
            document.getElementById('admin-login').classList.remove('hidden');
        }

        function showParticipantInterface() {
            document.getElementById('participant-interface').classList.remove('hidden');
            document.getElementById('participant-name').value = participants[currentUser];
            
            const today = new Date();
            document.getElementById('meeting-date').value = today.toISOString().split('T')[0];
            
            loadUserVotes();
            renderIdeas();
        }

        function checkAdminPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === 'Br88080187') {
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                loadAdminDashboard();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        function renderIdeas() {
            const viableContainer = document.getElementById('viable-ideas');
            const disruptiveContainer = document.getElementById('disruptive-ideas');

            viableContainer.innerHTML = viableIdeas.map(idea => createIdeaCard(idea, 'viable')).join('');
            disruptiveContainer.innerHTML = disruptiveIdeas.map(idea => createIdeaCard(idea, 'disruptive')).join('');
        }

        function createIdeaCard(idea, type) {
            const currentRating = userVotes[idea.id] || 0;
            return `
                <div class="idea-card bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-semibold text-gray-800 flex-1">${idea.title}</h3>
                        <div class="ml-4">
                            <button onclick="resetRating('${idea.id}')" class="text-gray-400 hover:text-red-500 text-sm">
                                <i class="fas fa-undo"></i> Zerar
                            </button>
                        </div>
                    </div>
                    <p class="text-gray-600 mb-4">${idea.description}</p>
                    <div class="flex items-center justify-between">
                        <div class="star-rating" data-idea="${idea.id}">
                            ${Array.from({length: 10}, (_, i) => 
                                `<i class="fas fa-star star ${i < currentRating ? 'active' : ''}" data-rating="${i + 1}" onclick="setRating('${idea.id}', ${i + 1})"></i>`
                            ).join('')}
                        </div>
                        <span class="text-sm font-medium text-gray-700">
                            ${currentRating}/10
                        </span>
                    </div>
                </div>
            `;
        }

        function setRating(ideaId, rating) {
            userVotes[ideaId] = rating;
            saveUserVotes();
            updateStarDisplay(ideaId, rating);
        }

        function resetRating(ideaId) {
            userVotes[ideaId] = 0;
            saveUserVotes();
            updateStarDisplay(ideaId, 0);
        }

        function updateStarDisplay(ideaId, rating) {
            const stars = document.querySelectorAll(`[data-idea="${ideaId}"] .star`);
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
            
            const ratingSpan = document.querySelector(`[data-idea="${ideaId}"]`).parentElement.querySelector('span');
            ratingSpan.textContent = `${rating}/10`;
        }

        function loadUserVotes() {
            const saved = localStorage.getItem(`votes_${currentUser}`);
            userVotes = saved ? JSON.parse(saved) : {};
        }

        function saveUserVotes() {
            localStorage.setItem(`votes_${currentUser}`, JSON.stringify(userVotes));
        }

        async function submitVoting() {
            const brainstormNotes = document.getElementById('brainstorm-notes').value;
            const meetingDate = document.getElementById('meeting-date').value;
            
            // Save submission data
            const submissionData = {
                participant: participants[currentUser],
                code: currentUser,
                votes: userVotes,
                brainstorm: brainstormNotes,
                date: meetingDate,
                submittedAt: new Date().toISOString()
            };
            
            // BACKUP SOLUTION: Always save locally
            localStorage.setItem(`submission_${currentUser}`, JSON.stringify(submissionData));
            
            // BACKUP SOLUTION: Try direct RTDB call
            const result = await saveToRTDB(currentUser, submissionData);
            let backendUsed = result.success ? result.backend : 'localStorage';
            
            // Show submission data for manual backup
            document.getElementById('backup-data').innerHTML = `
                <strong>DADOS PARA BACKUP MANUAL:</strong><br>
                <code>${JSON.stringify(submissionData, null, 2)}</code>
            `;
            
            console.log('üìã DADOS ENVIADOS:', submissionData);
            console.log('üîó Backend usado:', backendUsed);
            
            // Show success message
            document.getElementById('voting-active').classList.add('hidden');
            document.getElementById('submission-success').classList.remove('hidden');
        }

        function loadAdminDashboard() {
            refreshData();
        }

        async function refreshData() {
            await updateParticipantsStatus();
            updateResultsSummary();
            updateDetailedResults();
        }

        async function updateParticipantsStatus() {
            const container = document.getElementById('participants-status');
            
            // BACKUP SOLUTION: Try RTDB first, then localStorage
            const rtdbResult = await getAllFromRTDB();
            const rtdbData = rtdbResult.success ? rtdbResult.data : {};
            
            const statuses = Object.entries(participants).map(([code, name]) => {
                const submittedRTDB = Boolean(rtdbData[code]);
                const submittedLocal = Boolean(localStorage.getItem(`submission_${code}`));
                const submitted = submittedRTDB || submittedLocal;
                
                const status = submitted ? 'Enviado' : 'Pendente';
                const statusColor = submitted ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                const icon = submitted ? 'fa-check-circle text-green-500' : 'fa-clock text-yellow-500';
                const source = submittedRTDB ? '(RTDB)' : submittedLocal ? '(Local)' : '';
                
                return `
                    <div class="p-3 border rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <i class="fas ${icon} mr-2"></i>
                                <span class="font-medium text-sm">${name}</span>
                            </div>
                            <button onclick="resetParticipant('${code}')" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 border border-red-300 rounded hover:bg-red-50 transition-colors" title="Zerar dados deste participante">
                                <i class="fas fa-trash"></i> Reset
                            </button>
                        </div>
                        <div class="mt-1">
                            <span class="px-2 py-1 rounded-full text-xs ${statusColor}">${status} ${source}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = statuses.join('');
        }

        async function resetParticipant(participantCode) {
            const participantName = participants[participantCode];
            
            if (confirm(`Tem certeza que deseja zerar todos os dados de ${participantName}? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                // Remove local data
                localStorage.removeItem(`submission_${participantCode}`);
                localStorage.removeItem(`votes_${participantCode}`);
                
                // Try to remove from RTDB
                try {
                    await fetch(`${firebaseConfig.databaseURL}/submissions/${participantCode}.json`, {
                        method: 'DELETE'
                    });
                    console.log('‚úÖ Dados removidos do RTDB');
                } catch (error) {
                    console.error('‚ùå Erro ao remover do RTDB:', error);
                }
                
                // Refresh dashboard
                refreshData();
                alert(`Dados de ${participantName} foram zerados com sucesso!`);
            }
        }

        async function updateResultsSummary() {
            const allVotes = await getAllVotes();
            const viableResults = calculateResults(viableIdeas, allVotes);
            const disruptiveResults = calculateResults(disruptiveIdeas, allVotes);
            
            // Top 3 Viable
            const topViable = viableResults.slice(0, 3);
            document.getElementById('top-viable').innerHTML = topViable.map((item, index) => 
                `<div class="flex items-center p-2 bg-yellow-50 rounded">
                    <span class="font-bold text-yellow-600 mr-2">${index + 1}¬∫</span>
                    <span class="flex-1">${item.title}</span>
                    <span class="font-semibold text-yellow-700">${item.totalScore} pts</span>
                </div>`
            ).join('');
            
            // Top 3 Disruptive
            const topDisruptive = disruptiveResults.slice(0, 3);
            document.getElementById('top-disruptive').innerHTML = topDisruptive.map((item, index) => 
                `<div class="flex items-center p-2 bg-purple-50 rounded">
                    <span class="font-bold text-purple-600 mr-2">${index + 1}¬∫</span>
                    <span class="flex-1">${item.title}</span>
                    <span class="font-semibold text-purple-700">${item.totalScore} pts</span>
                </div>`
            ).join('');
            
            // Overall Champion
            const allResults = [...viableResults, ...disruptiveResults].sort((a, b) => b.totalScore - a.totalScore);
            const champion = allResults[0];
            
            if (champion) {
                document.getElementById('overall-champion').innerHTML = `
                    <h3 class="text-xl font-bold text-yellow-700 mb-2">üèÜ CAMPE√ÉO GERAL</h3>
                    <p class="text-lg font-semibold">${champion.title}</p>
                    <p class="text-2xl font-bold text-yellow-600">${champion.totalScore} pontos</p>
                `;
            }
        }

        async function updateDetailedResults() {
            const allVotes = await getAllVotes();
            const viableResults = calculateResults(viableIdeas, allVotes);
            const disruptiveResults = calculateResults(disruptiveIdeas, allVotes);
            
            const detailedHtml = `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-yellow-600">Ideias Vi√°veis - Resultados Completos</h3>
                        ${renderDetailedResults(viableResults)}
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4 text-purple-600">Ideias Disruptivas - Resultados Completos</h3>
                        ${renderDetailedResults(disruptiveResults)}
                    </div>
                </div>
            `;
            
            document.getElementById('detailed-results').innerHTML = detailedHtml;
        }

        function renderDetailedResults(results) {
            return results.map((item, index) => `
                <div class="border rounded-lg p-4 mb-3">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-800">${index + 1}¬∫ - ${item.title}</h4>
                        <div class="text-right">
                            <div class="text-xl font-bold text-blue-600">${item.totalScore} pts</div>
                            <div class="text-sm text-gray-500">${item.votes} votos</div>
                            <div class="text-sm text-gray-500">M√©dia: ${item.average.toFixed(1)}</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">${item.description}</div>
                </div>
            `).join('');
        }

        async function getAllVotes() {
            const allVotes = {};
            
            // BACKUP SOLUTION: Get from RTDB first, then localStorage
            const rtdbResult = await getAllFromRTDB();
            const rtdbData = rtdbResult.success ? rtdbResult.data : {};
            
            Object.keys(participants).forEach(code => {
                if (rtdbData[code] && rtdbData[code].votes) {
                    allVotes[code] = rtdbData[code].votes;
                } else {
                    const submission = localStorage.getItem(`submission_${code}`);
                    if (submission) {
                        const data = JSON.parse(submission);
                        allVotes[code] = data.votes;
                    }
                }
            });
            
            return allVotes;
        }

        function calculateResults(ideas, allVotes) {
            return ideas.map(idea => {
                let totalScore = 0;
                let voteCount = 0;
                
                Object.values(allVotes).forEach(votes => {
                    if (votes[idea.id]) {
                        totalScore += votes[idea.id];
                        voteCount++;
                    }
                });
                
                return {
                    ...idea,
                    totalScore,
                    votes: voteCount,
                    average: voteCount > 0 ? totalScore / voteCount : 0
                };
            }).sort((a, b) => b.totalScore - a.totalScore);
        }

        function exportToPDF() {
            window.print();
        }

        async function copyResults() {
            const allVotes = await getAllVotes();
            const viableResults = calculateResults(viableIdeas, allVotes);
            const disruptiveResults = calculateResults(disruptiveIdeas, allVotes);
            const allResults = [...viableResults, ...disruptiveResults].sort((a, b) => b.totalScore - a.totalScore);
            
            let resultsText = '=== RESULTADOS CONSOLIDADOS - 1¬∫ HACKATHON+ SESI SA√öDE ===\n\n';
            
            resultsText += 'üèÜ CAMPE√ÉO GERAL:\n';
            if (allResults[0]) {
                resultsText += `${allResults[0].title} - ${allResults[0].totalScore} pontos\n\n`;
            }
            
            resultsText += 'üî• TOP 3 IDEIAS VI√ÅVEIS:\n';
            viableResults.slice(0, 3).forEach((item, index) => {
                resultsText += `${index + 1}¬∫ - ${item.title} (${item.totalScore} pts)\n`;
            });
            
            resultsText += '\nüöÄ TOP 3 IDEIAS DISRUPTIVAS:\n';
            disruptiveResults.slice(0, 3).forEach((item, index) => {
                resultsText += `${index + 1}¬∫ - ${item.title} (${item.totalScore} pts)\n`;
            });
            
            resultsText += '\nüìä PARTICIPA√á√ÉO:\n';
            const submittedCount = Object.keys(allVotes).length;
            resultsText += `${submittedCount}/${Object.keys(participants).length} participantes enviaram suas vota√ß√µes\n`;
            
            navigator.clipboard.writeText(resultsText).then(() => {
                alert('Resultados copiados para a √°rea de transfer√™ncia!');
            });
        }

        async function exportAllData() {
            const rtdbResult = await getAllFromRTDB();
            const rtdbData = rtdbResult.success ? rtdbResult.data : {};
            
            const allData = {};
            Object.keys(participants).forEach(code => {
                if (rtdbData[code]) {
                    allData[code] = rtdbData[code];
                } else {
                    const submission = localStorage.getItem(`submission_${code}`);
                    if (submission) {
                        allData[code] = JSON.parse(submission);
                    }
                }
            });
            
            const dataBlob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hackathon_dados_completos_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
